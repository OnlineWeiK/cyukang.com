
<!DOCTYPE html>
<html>
   <link rel="stylesheet" href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/assets/themes/twitter/css/style.css" />

  <header>
    <meta charset="utf-8">
    
    <title>Clang is Making Emacs Smarter | Yukang's Page</title>
    
    <meta name="description" content="">
    <meta name="author" content="Yukang">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <script type="text/javascript"
	src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>


    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!-- Update these with your own images
	 <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	 <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	 <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
	 -->
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">Yukang's Page</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/archive.html">归档</a></li>
      	
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">标签</a></li>
      	
      
    
  




            <li class="divider-vertical"></li>
            
            
            


  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">关于</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  
    
  
    
      
    
  
    
      
    
  





            <li><a href="http://feed.feedsky.com/moorekang">订阅</a></li>
          </ul>

          <span class="pull-right slogan"> Keep it Simple and Stupid </span>
        </div>
      </div>
    </div>
  </header>
  

  <body>
    <div class="container">
      <div class="content">
        

<div class="row post">
  <div class="span8">
    <h1 class="title">Clang is Making Emacs Smarter</h1>

    
<p>在Emacs下自动补全总是个问题，对于同一个buffer内的基于symbol补全auto-complete-mode做得非常好了，但是因为没有进行代码的分析，所以像结构体的成员变量或者类的成员函数的补全是不可能的。当然你可能试过这个号称最智能的<a href="http://cx4a.org/software/gccsense/">GCCSence</a>,但是我觉得这个东西够复杂的，在使用之前还需要用户手动运行一个命令来用Gcc处理一遍，它还会把一些东西放在sqlite数据库里面。这大概是因为Gcc不编译做静态分析工具造成的，在<a href="http://lwn.net/Articles/493599/">这里</a>、<a href="http://lwn.net/Articles/493627/">这里</a>、<a href="http://lwn.net/Articles/493630/">这里</a>有讨论，Google的一个静态分析的项目从Gcc迁移到LLVM，重点是这:</p>

<pre><code>The gcc version has been difficult to support and maintain, due mainly to the fact that the GIMPLE intermediate language was never designed for static analysis. The abstract syntax tree provided by Clang is an easier data structure to work with for front-end analyses of this kind.
</code></pre>

<p>这个thread挺好玩的，后面变成了一大群人争论functional programming和Imperative Programming。这篇<a href="http://fpcomplete.com/the-downfall-of-imperative-programming/">The Downfall of Imperative Programming</a>再好好看看。</p>

<p>回到正题，我最近切换到Mac下。因为在Mac OS X下编译器变成了Clang， Clang是基于LLVM的。LLVM对于分析代码是有比较方便的支持，所以基于LLVM有各种分析源程序的工具了，Xcode下的一些辅助开发的工具还是很舒服的。前些天突然想到那么会不会有个东西来作为Emacs的自动补全的后端，一搜果然有了这个<a href="https://github.com/mikeandmore/auto-complete-clang">auto-complete-clang</a>，使用了一下非常的方便。其实看看其代码是在后面调用Clang的，比如在main.cc源文件里面写一些代码:</p>

<div class="highlight"><pre><code class="cpp">    <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span>
    <span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">vector</span><span class="o">&gt;</span>
    <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
    
    <span class="k">class</span> <span class="nc">Demo</span><span class="p">{</span>
    <span class="nl">public:</span>
        <span class="kt">void</span> <span class="n">print</span><span class="p">();</span>
        <span class="kt">void</span> <span class="nf">test</span><span class="p">();</span>
    <span class="nl">private:</span>
        <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">Demo</span> <span class="n">demo</span><span class="p">;</span>
        <span class="n">demo</span><span class="p">.</span>
    <span class="p">}</span>
</code></pre></div>

<p>结果还是非常精准的，不想截图了。后端运行的命令其实是:</p>

<div class="highlight"><pre><code class="sh">    cmd: clang -cc1 main.cc -fsyntax-only -code-completion-at main.cc:18:10
</code></pre></div>

<p>所得到的结果是:</p>

<div class="highlight"><pre><code class="sh">    COMPLETION: Demo : Demo::
    COMPLETION: <span class="nv">operator</span><span class="o">=</span> : <span class="o">[</span><span class="c">#Demo &amp;#]operator=(&lt;#const Demo &amp;#&gt;)</span>
    COMPLETION: print : <span class="o">[</span><span class="c">#void#]print()</span>
    COMPLETION: <span class="nb">test</span> : <span class="o">[</span><span class="c">#void#]test()</span>
    COMPLETION: value : <span class="o">[</span><span class="c">#int#]value</span>
    COMPLETION: ~Demo : <span class="o">[</span><span class="c">#void#]~Demo()</span>
</code></pre></div>

<p>auto-complete-clang做的事情就是把这个结果再展示出来，其实这条命令也做了语法检查的，所以加上一个语法检查的功能应该也是可以的。一搜果然还是有了，看这个<a href="http://duncan.mac-vicar.com/2011/08/30/realtime-syntax-checking-with-emacs/">Realtime syntax checking with emacs</a>，需要翻墙，不过代码在<a href="https://github.com/dmacvicar/duncan-emacs-setup/tree/master/site-lisp">Github上</a>。其实其后端运行的命令是：</p>

<div class="highlight"><pre><code class="sh">   cmd: clang  -fsyntax-only -fno-exceptions main.cc
</code></pre></div>

<p>最近用这个插件，基本代码都会是一遍编译通过啊，哈哈。Clang错误提示也人性化一点，比如在Xcode下会提示你想的是不是”XXX”之类的。</p>



    <p class="meta"> -- EOF -- </p>

    <ul class="pager">

      
      <li class="next"><a href="/2012/12/13/move-to-mac-os-x.html" title="Moving to Mac">Moving to Mac&rarr;</a></li>
      

      
      <li class="previous"><a href="/2012/12/26/browser-objs-in-ruby.html" title="Browser objs and class hierarchy  in Ruby">&larr; Browser objs and class hierarchy  in Ruby</a></li>
      


    </ul>

    <div class="span8">
      <p>声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="nofollow" title="署名-非商业性使用-相同方式共享">BY-NC-SA</a> 协议进行授权. 转载请注明转自: <a href="/2012/12/16/use-clang-autocomplete-mode.html" title="Clang is Making Emacs Smarter" rel="nofollow">Clang is Making Emacs Smarter</a></p>
    </div>


    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_developer = 1;
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'yukang'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
      BYB.includeScript('/assets/themes/twitter/prettify/prettify.js',function(){prettyPrint()});
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
  </div>
  

  <div class="span4 sidebar">
    <h4 class="date">发布日期：<span>16 December 2012</span></h4>
    <!-- <p class="meta">By <a href="/about.html" class="author" title="author">Yukang</a><g:plusone size="small"></g:plusone></p> -->


    
    <h4>标签</h4>
    <ul class="tag_box">
      
      


  
     
    	<li><a href="/tags.html#LLVM-ref">LLVM <span>1</span></a></li>
     
    	<li><a href="/tags.html#Gcc-ref">Gcc <span>1</span></a></li>
     
    	<li><a href="/tags.html#Emacs-ref">Emacs <span>7</span></a></li>
    
  



    </ul>
      

    <nav class="nav">
      <ul>
	<li><a href="/" >首页</a></li>
	<li><a href="/archive.html" >归档</a></li>
	<li><a href="/tags.html" >标签</a></li>
	<li><a href="/about.html" >关于</a></li>
	<li><a href="/atom.xml" target="_blank" >RSS</a></li>
      </ul>
    </nav> 


    <div class="violet-aside-post">
      <h4 class="v-section-tit">最近</h4>
      <ul>
           
        <li class="v-aside-li">
          <a href="/2013/07/06/studying-rails.html" title="初学Rails" rel="bookmark">初学Rails</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/05/18/critbit.html" title="高效的Crit-bit Tree" rel="bookmark">高效的Crit-bit Tree</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/05/09/git-command.html" title="迁移到Git" rel="bookmark">迁移到Git</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/04/17/lua_10_source.html" title="看看Lua 1.0 代码" rel="bookmark">看看Lua 1.0 代码</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/04/17/apt-usage.html" title="一些包管理命令" rel="bookmark">一些包管理命令</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/04/11/xor_link_list.html" title="巧妙的XOR Link List" rel="bookmark">巧妙的XOR Link List</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/03/03/try-mathjax.html" title="Jekyll使用MathJax来显示数学式" rel="bookmark">Jekyll使用MathJax来显示数学式</a>
        </li>              	      	            
           
        <li class="v-aside-li">
          <a href="/2013/02/15/reading-bootstrap-scheme.html" title="读bootstrap scheme" rel="bookmark">读bootstrap scheme</a>
        </li>              	      	            
        
      </ul>  
    </div>


    <nav class="nav">
      <h4 class="v-section-tit">链接</h4>
      <ul>
	<li><a href="http://www.wutianqi.com/" target="_blank" rel="nofollow">Tanky Woo</a></li>
	<li><a href="http://beiyuu.com/"  target="_blank" rel="nofollow">Beiyuu</a></li>
	<li><a href="http://wangcong.org/blog/" target="_blank" rel="nofollow">王聪</a></li>
	<li><a href="http://helloworld.tk/" target="_blank" rel="nofollow">邓甜</a></li>
	<li><a href="http://www.cguage.com/" target="_blank" rel="nofollow">C瓜</a></li>
	<li><a href="http://www.crazyshell.org/blog/" target="_blank" rel="nofollow">狂Shell</a></li>
      </ul>
    </nav> 


  </div>
</div>




      </div>

      <footer>
        <p>&copy; <a href="mailto:moorekang@gmail.com">Yukang</a> 2012. 
          Proudly powered by <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>

	<script type="text/javascript">
	  var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
	  document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fba1315646a61cc7bd6f574a6b5221640' type='text/javascript'%3E%3C/script%3E"));
	</script>

      </footer>
    </div> <!-- /container -->

    


  </body>
</html>

